<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:avalonia="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
        xmlns:viewModels="clr-namespace:MSUScripter.ViewModels"
        xmlns:controls="clr-namespace:AvaloniaControls.Controls;assembly=AvaloniaControls"
        xmlns:views="clr-namespace:MSUScripter.Views"
        mc:Ignorable="d"
        d:DesignWidth="1280" 
        d:DesignHeight="800"
        MinWidth="1280"
        MinHeight="800"
        Width="1280"
        Height="800"
        x:Class="MSUScripter.Views.MsuProjectWindow"
        x:DataType="viewModels:MsuProjectWindowViewModel"
        Loaded="WindowControl_OnLoaded"
        Closing="Window_OnClosing"
        PointerPressed="Window_OnPointerPressed"
        DragDrop.AllowDrop="True"
        Title="{Binding WindowTitle}">
    <LayoutTransformControl Name="MainLayout">
        <DockPanel>
            <Grid RowDefinitions="*, Auto">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250" MinWidth="31" MaxWidth="400"></ColumnDefinition>
                    <ColumnDefinition Width="4"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <Grid Grid.Row="0" Grid.Column="0" RowDefinitions="Auto, *, Auto, Auto">
                    <Border Grid.Row="0" Background="{DynamicResource CardBorderColor}">
                        <ScrollViewer HorizontalScrollBarVisibility="Hidden">
                            <StackPanel Margin="3" Orientation="Horizontal">
                                <controls:ContextMenuButton 
                                    Padding="5"
                                    Margin="0 0 2 0"
                                    ToolTip.Tip="{Binding Text.ProjectWindowMainMenu}"
                                >
                                    <Button.ContextMenu>
                                        <ContextMenu>
                                            <controls:IconMenuItem 
                                                Header="{Binding Text.MenuItemNewProject}"
                                                IconKind="InvoiceTextNewOutline"
                                                Click="NewProjectMenuItem_OnClick"
                                            />
                                            <controls:IconMenuItem 
                                                Header="{Binding Text.MenuItemOpenProject}"
                                                IconKind="FolderOpenOutline"
                                                x:Name="BrowseMenu"
                                            >
                                                <controls:IconMenuItem  
                                                    Header="{Binding Text.MenuItemOpenFromFile}"
                                                    IconKind="FolderOpenOutline"
                                                    Click="BrowseMsuProjectMenuItem_OnClick"
                                                />
                                                <Separator></Separator>
                                            </controls:IconMenuItem>
                                            <controls:IconMenuItem  
                                                Name="SaveProjectMenuItem"
                                                Header="{Binding Text.MenuItemSaveProject}"
                                                IconKind="ContentSaveOutline"
                                                Click="SaveMenuItem_OnClick"
                                            />
                                            <controls:IconMenuItem 
                                                Header="{Binding Text.MenuItemCloseProject}"
                                                IconKind="ExitToApp"
                                                Click="CloseProjectMenuItem_OnClick"
                                            />
                                            <Separator />
                                            <controls:IconMenuItem 
                                                Header="{Binding Text.MenuItemSettings}"
                                                IconKind="SettingsOutline"
                                                Click="OpenSettingsMenuItem_OnClick"
                                            />
                                            <controls:IconMenuItem 
                                                Header="{Binding Text.MenuItemExitApp}"
                                                IconKind="Power"
                                                Click="ExitApplicationMenuItem_OnClick"
                                            />
                                        </ContextMenu>
                                    </Button.ContextMenu>
                                    <avalonia:MaterialIcon Kind="HamburgerMenu"></avalonia:MaterialIcon>
                                </controls:ContextMenuButton>
                                
                                <Button
                                    Name="SaveButton"
                                    Padding="5 5"
                                    Margin="0 0 2 0"
                                    ToolTip.Tip="{Binding Text.ProjectWindowSaveProject}"
                                    Click="SaveButton_OnClick"
                                >
                                    <avalonia:MaterialIcon Kind="FloppyDisk"></avalonia:MaterialIcon>
                                </Button>
                                
                                <Button
                                    Padding="5 5"
                                    Margin="0 0 2 0"
                                    ToolTip.Tip="{Binding Text.ProjectWindowOpenMsuFolder}"
                                    Click="OpenFolderButton_OnClick"
                                >
                                    <avalonia:MaterialIcon Kind="FolderEye"></avalonia:MaterialIcon>
                                </Button>
                                
                                <Button
                                    Padding="5 5"
                                    Margin="0 0 2 0"
                                    ToolTip.Tip="{Binding Text.ProjectWindowAnalyzeAudio}"
                                    Click="OpenAnalyzeProjectButton_OnClick"
                                >
                                    <avalonia:MaterialIcon Kind="Analytics"></avalonia:MaterialIcon>
                                </Button>
                                
                                <SplitButton
                                    Padding="5 5"
                                    Margin="0 0 2 0"
                                    ToolTip.Tip="{Binding Text.ProjectWindowExportProject}"
                                    Click="GenerateButton_OnClick"
                                >
                                    <SplitButton.Flyout>
                                        <MenuFlyout Placement="BottomEdgeAlignedLeft">
                                            <views:ToolTipMenuItem
                                                IconKind="ExportVariant" 
                                                Click="GenerateMenuItem_OnClick"
                                                LabelText="{Binding Text.MenuItemGenerateMsuLabel}" 
                                                ToolTipText="{Binding Text.MenuItemGenerateMsuToolTip}"
                                            />
                                            <views:ToolTipMenuItem
                                                IconKind="Text"
                                                Click="GenerateTracksJsonMenuItem_OnClick"
                                                LabelText="{Binding Text.MenuItemCreateTracksJsonLabel}"
                                                ToolTipText="{Binding Text.MenuItemCreateTracksJsonToolTip}"
                                            />
                                            <views:ToolTipMenuItem
                                                IconKind="Text"
                                                Click="CreateYamlMenuItem_OnClick"
                                                LabelText="{Binding Text.MenuItemCreateYamlLabel}"
                                                ToolTipText="{Binding Text.MenuItemCreateYamlToolTip}"
                                            />
                                            <views:ToolTipMenuItem
                                                IconKind="Text"
                                                Click="CreateTrackListMenuItem_OnClick"
                                                LabelText="{Binding Text.MenuItemCreateTrackListLabel}"
                                                ToolTipText="{Binding Text.MenuItemCreateTrackListToolTip}"
                                            />
                                            <views:ToolTipMenuItem
                                                IconKind="ScriptOutline"
                                                Click="CreateScriptsMenuItem_OnClick"
                                                LabelText="{Binding Text.MenuItemCreateSwapScriptsLabel}"
                                                ToolTipText="{Binding Text.MenuItemCreateSwapScriptsToolTip}"
                                            />
                                            <views:ToolTipMenuItem
                                                IconKind="VideoOutline" 
                                                Click="CopyrightYouTubeVideoMenuItem_OnClick"
                                                LabelText="{Binding Text.MenuItemCreateYouTubeVideoDetailsLabel}" 
                                                ToolTipText="{Binding Text.MenuItemCreateYouTubeVideoDetailsToolTip}"
                                            />
                                            
                                        </MenuFlyout>
                                    </SplitButton.Flyout>
                                    <avalonia:MaterialIcon Kind="ExportVariant"></avalonia:MaterialIcon>
                                    
                                </SplitButton>
                                
                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                    
                    <DockPanel Grid.Row="1">
                        <Grid ColumnDefinitions="*, Auto, Auto" DockPanel.Dock="Top" Margin="2 2 0 2">
                            <TextBox
                                Grid.Column="0"
                                FontSize="12"
                                Padding="18 0 0 0"
                                BorderBrush="DimGray"
                                Watermark="Filter"
                                Text="{Binding FilterText}"
                                TextChanged="FilterTextBox_OnTextChanged"
                            ></TextBox>
                            <avalonia:MaterialIcon Grid.Column="0" Kind="Search" HorizontalAlignment="Left" Margin="2 0 0 0"></avalonia:MaterialIcon>
                            <controls:ContextMenuButton Grid.Column="2" Padding="1 0" Margin="2 0 0 0">
                                <Button.ContextMenu>
                                    <ContextMenu Closed="TreeItemMenuBase_OnClosed">
                                        <controls:CheckedMenuItem 
                                            Header="{Binding Text.ProjectWindowFilterOnlyTracksMissingSongs}" 
                                            IsChecked="{Binding FilterOnlyTracksMissingSongs}"
                                            Click="ToggleFilterTracksMissingSongsMenuItem_OnClick"
                                        />
                                        <controls:CheckedMenuItem 
                                            Header="{Binding Text.ProjectWindowFilterOnlyIncomplete}" 
                                            IsChecked="{Binding FilterOnlyIncomplete}"
                                            Click="ToggleFilterIncompleteMenuItem_OnClick"
                                        />
                                        <controls:CheckedMenuItem  
                                            Header="{Binding Text.ProjectWindowFilterOnlyMissingAudio}" 
                                            IsChecked="{Binding FilterOnlyMissingAudio}"
                                            Click="ToggleFilterMissingAudioMenuItem_OnClick"
                                        />
                                        <controls:CheckedMenuItem 
                                            Header="{Binding Text.ProjectWindowFilterOnlyCopyrightUntested}" 
                                            IsChecked="{Binding FilterOnlyCopyrightUntested}"
                                            Click="ToggleCopyrightUntestedMenuItem_OnClick"
                                        />
                                        <controls:IconMenuItem
                                            IconKind="Refresh"
                                            Header="Reapply Filters"
                                            Click="ReapplyFiltersMenuItem_OnClick"
                                        />
                                        <Separator />
                                        <controls:CheckedMenuItem 
                                            Header="{Binding Text.ProjectWindowDisplayIsCompleteIcon}"
                                            IsChecked="{Binding DisplayIsCompleteIcon}"
                                            Click="DisplayIsCompleteMenuItem_OnClick"
                                        />
                                        <controls:CheckedMenuItem 
                                            Header="{Binding Text.ProjectWindowDisplayHasSongIcon}"
                                            IsChecked="{Binding DisplayHasSongIcon}"
                                            Click="DisplayHasAudioMenuItem_OnClick"
                                        />
                                        <controls:CheckedMenuItem 
                                            Header="{Binding Text.ProjectWindowDisplayCheckCopyrightIcon}" 
                                            IsChecked="{Binding DisplayCheckCopyrightIcon}"
                                            Click="DisplayCopyrightTestMenuItem_OnClick"
                                        />
                                        <controls:CheckedMenuItem 
                                            Header="{Binding Text.ProjectWindowDisplayCopyrightSafeIcon}" 
                                            IsChecked="{Binding DisplayCopyrightSafeIcon}"
                                            Click="DisplayCopyrightStatusMenuItem_OnClick"
                                        />
                                    </ContextMenu>
                                    
                                </Button.ContextMenu>
                                <avalonia:MaterialIcon Kind="{Binding FilterEyeIcon}" Width="14"></avalonia:MaterialIcon>
                            </controls:ContextMenuButton>
                        </Grid>
                        
                        <ListBox
                            BorderThickness="0"
                            ItemsSource="{Binding TreeItems}"
                            SelectedItem="{Binding SelectedTreeItem, Mode=TwoWay}"
                            SelectionChanged="TreeListBox_OnSelectionChanged"
                            HorizontalAlignment="Stretch"
                            Name="TreeListBox"
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                        >
                            <ListBox.Styles> 
                                <Style Selector="ListBoxItem"> <Setter Property="Padding" Value="0" /> </Style> 
                            </ListBox.Styles>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border 
                                        HorizontalAlignment="Stretch"
                                        Background="{Binding GridBackground}"
                                        BorderThickness="0 0 0 2"
                                        IsVisible="{Binding IsVisible}"
                                        Tag="{Binding}"
                                        PointerPressed="TreeItemInputElement_OnPointerPressed"
                                        PointerReleased="TreeItemInputElement_OnPointerReleased"
                                        PointerEntered="TreeItemInputElement_OnPointerEntered"
                                        PointerExited="TreeItemInputElement_OnPointerExited"
                                        BorderBrush="{Binding BorderColor}"
                                    >
                                        <Border.ContextMenu>
                                            <ContextMenu Opened="TreeContextMenuBase_OnOpened" Tag="{Binding}">
                                                <controls:IconMenuItem
                                                    Header="{Binding Text.MenuItemCopyToClipboard}"
                                                    IsEnabled="{Binding CanDelete}"
                                                    Tag="{Binding}"
                                                    Click="CopySongMenuItem_OnClick"
                                                    IconKind="ContentCopy"
                                                />
                                                <controls:IconMenuItem
                                                    Header="{Binding Text.MenuItemPasteFromClipboard}"
                                                    IsEnabled="{Binding CanDelete}"
                                                    Tag="{Binding}"
                                                    Click="PasteMenuItem_OnClick"
                                                    IconKind="ContentPaste"
                                                />
                                                <controls:IconMenuItem
                                                    Header="{Binding Text.MenuItemDuplicateSongDetails}"
                                                    IsEnabled="{Binding CanDelete}"
                                                    Tag="{Binding}"
                                                    Click="DuplicateSongMenuItem_OnClick"
                                                    IconKind="ContentDuplicate"
                                                />
                                                <controls:IconMenuItem 
                                                    Header="{Binding Text.MenuItemDeleteSongDetails}" 
                                                    IsEnabled="{Binding CanDelete}"
                                                    Tag="{Binding}"
                                                    Click="DeleteSongMenuItem_OnClick"
                                                    IconKind="TrashCanOutline"
                                                />
                                            </ContextMenu>
                                        </Border.ContextMenu>
                                        <Grid ColumnDefinitions="Auto, *" 
                                              HorizontalAlignment="Stretch"
                                        >
                                            <Panel Grid.Column="0" Width="{Binding LeftSpacing}"></Panel>
                                            <DockPanel Grid.Column="1">
                                                <StackPanel Orientation="Horizontal">
                                                    <controls:ImageButton 
                                                        Click="TreeLeftIconButton_OnClick" 
                                                        Tag="{Binding}"
                                                    >
                                                        <avalonia:MaterialIcon
                                                            Kind="{Binding CollapseIcon}" 
                                                            Opacity="{Binding CollapseIconOpacity}"
                                                            Width="14" 
                                                            Margin="0 0 0 1"
                                                        ></avalonia:MaterialIcon>
                                                    </controls:ImageButton>
                                                    <controls:ImageButton  
                                                        Click="ToggleCompleteButton_OnClick" 
                                                        Tag="{Binding}"
                                                        DockPanel.Dock="Left"
                                                        IsVisible="{Binding DisplayIsCompleteIcon}"
                                                    >
                                                        <avalonia:MaterialIcon 
                                                            Kind="{Binding  CompletedIconKind}" 
                                                            Width="14" 
                                                            Foreground="{Binding CompletedIconColor}"
                                                            Margin="0 0 0 1"
                                                        ></avalonia:MaterialIcon>
                                                    </controls:ImageButton>
                                                    <controls:ImageButton
                                                        Click="ToggleCopyrightSafeButton_OnClick"
                                                        Tag="{Binding}" 
                                                        DockPanel.Dock="Left" 
                                                        IsVisible="{Binding DisplayCopyrightSafeIcon}"
                                                    >
                                                        <avalonia:MaterialIcon 
                                                            Kind="{Binding CopyrightSafeIconKind}" 
                                                            Width="14" 
                                                            Foreground="{Binding CopyrightSafeIconColor}"
                                                            Margin="0 0 0 1">
                                                        </avalonia:MaterialIcon>
                                                    </controls:ImageButton>
                                                    <controls:ImageButton 
                                                        Click="ToggleCheckCopyrightButton_OnClick" 
                                                        Tag="{Binding}" 
                                                        DockPanel.Dock="Left" 
                                                        IsVisible="{Binding DisplayCheckCopyrightIcon}"
                                                    >
                                                        <avalonia:MaterialIcon 
                                                            Kind="{Binding CheckCopyrightIconKind}" 
                                                            Width="14" 
                                                            Foreground="{Binding CheckCopyrightIconColor}"
                                                            Margin="0 0 0 1">
                                                        </avalonia:MaterialIcon>
                                                    </controls:ImageButton>
                                                    <avalonia:MaterialIcon 
                                                        Kind="{Binding HasSongIconKind}" 
                                                        Width="14" 
                                                        Foreground="{Binding HasSongIconColor}"
                                                        IsVisible="{Binding DisplayHasSongIcon}"
                                                        Margin="0 0 0 1">
                                                    </avalonia:MaterialIcon>
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                                                    <controls:ImageButton 
                                                        IsVisible="{Binding ShowAddButton}"
                                                        Click="InsertSongButton_OnClick"
                                                        Tag="{Binding}"
                                                    >
                                                        <avalonia:MaterialIcon 
                                                            Kind="Plus" 
                                                            Margin="0 0 0 1"
                                                            Width="14">
                                                        </avalonia:MaterialIcon>
                                                    </controls:ImageButton>
                                                    <controls:ImageButton IsVisible="{Binding ShowMenuButton}" Click="MenuButton_OnClick">
                                                        <avalonia:MaterialIcon 
                                                            Kind="DotsHorizontal" 
                                                            Margin="0 0 0 1"
                                                            Width="14">
                                                        </avalonia:MaterialIcon>
                                                    </controls:ImageButton>
                                                </StackPanel>
                                                <TextBlock 
                                                    Text="{Binding Name}" 
                                                    TextTrimming="CharacterEllipsis"
                                                    HorizontalAlignment="Stretch" 
                                                    Background="Transparent"
                                                    Padding="2"
                                                    Tag="{Binding}"
                                                    DoubleTapped="InputElement_OnDoubleTapped"
                                                ></TextBlock>
                                            </DockPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </DockPanel>
                    
                    
                    <Border Grid.Row="2" Background="{DynamicResource CardBorderColor}" Name="SummaryBorder">
                        <StackPanel Margin="5" Orientation="Vertical">
                            <TextBlock Text="{Binding SongSummary}" HorizontalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                            <TextBlock Text="{Binding TrackSummary}" HorizontalAlignment="Center" TextTrimming="CharacterEllipsis" />
                        </StackPanel>
                    </Border>
                </Grid>
                <GridSplitter Grid.Row="0" Grid.Column="1" Background="{DynamicResource CardBorderColor}"/>
                <Grid Grid.Row="0" Grid.Column="2">
                    <views:MsuSongOuterPanel
                        x:Name="MsuSongPanel"
                        IsVisible="{Binding IsEnabled}"
                        DataContext="{Binding MsuSongViewModel}"
                        NewSongClicked="MsuSongPanel_OnNewSongClicked"
                        IsCompleteUpdated="MsuSongPanel_OnIsCompleteUpdated"
                        InputFileUpdated="MsuSongPanel_OnInputFileUpdated"
                    ></views:MsuSongOuterPanel>
                    <Border Padding="5">
                        <views:MsuBasicInfoPanel
                            DataContext="{Binding BasicInfoViewModel}"
                            IsVisible="{Binding IsVisible}"
                        />
                    </Border>
                </Grid>
                <controls:HeaderFooter Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
                    <TextBlock
                        Name="StatusMessage"
                        VerticalAlignment="Center"
                        TextAlignment="Center"
                        HorizontalAlignment="Center"
                        Margin="5 11"
                        Height="16"
                        TextTrimming="CharacterEllipsis"
                        Text="{Binding StatusBarText}"
                    />
                </controls:HeaderFooter>
                <controls:HeaderFooter Grid.Row="1" Grid.Column="2">
                    <views:AudioControl 
                        Margin="5" 
                        CanSetTimeSeconds="True"
                    />
                </controls:HeaderFooter>
            </Grid>
        </DockPanel>
    </LayoutTransformControl>
</Window>
